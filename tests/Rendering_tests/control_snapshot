begin MHD_control
!!!!! Define for files !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!
!  num_subdomain_ctl: number of subdomains
!  num_smp_ctl:       number of smp processes
!
!  mesh_file_head_ctl:  header of mesh file (Default: in.domain#)
!
!  sph_file_prefix:     prefix of spherical transfoem grid
!  restart_file_prefix: prefix of restart file
!                            (Default: restart/rst.step#.domain#)
!  field_file_prefix:   prefix of snapshot field data
!                            (Default: out.step#.domain#.udt)
!
!  field_file_fmt_ctl:  data format for field files
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!
  begin data_files_def
    debug_flag_ctl            'Off'
!
    num_subdomain_ctl             7168
    num_smp_ctl                      1
!
    sph_file_prefix             '../sph_lm255_r335c_ic_7168_2/in'
    restart_file_prefix         '../sph_lm255_r335c_ic_7168_2/rst'
    field_file_prefix           '../sph_lm255_r335c_ic_7168_2/out'
!
    sph_file_fmt_ctl            'merged_bin_gzip'
    restart_file_fmt_ctl        'merged_bin_gzip'
    field_file_fmt_ctl          'merged_bin_gzip'
  end data_files_def
!
  file spherical_shell_ctl   '../sph_lm255_r335c_ic_7168_2/control_resolution'
!
  begin visual_control
    array surface_rendering
      file  surface_rendering   '../ctl_psf_cmb'
      file  surface_rendering   '../ctl_psf_z0'
      file  surface_rendering   '../ctl_psf_z0.3'
      file  surface_rendering   '../ctl_psf_z1.0'
      file  surface_rendering   '../ctl_psf_icb'
    end array surface_rendering
    array volume_rendering
      file volume_rendering   '../ctl_pvr_temp'
      file volume_rendering   '../ctl_pvr_Bmag'
      file volume_rendering   '../ctl_pvr_Tpole'
      file volume_rendering   '../ctl_pvr_Bpole'
      file volume_rendering   '../ctl_pvr_wz'
      file volume_rendering   '../ctl_pvr_vr'
!      file volume_rendering   '../ctl_pvr_temp2'
!      file volume_rendering   '../ctl_pvr_Bmag2'
    end array  volume_rendering
!
    array  LIC_rendering
      file  LIC_rendering  'ctl_lic_velo'
      file  LIC_rendering  'ctl_lic_magne'
      file  LIC_rendering  'ctl_lic_velo2'
      file  LIC_rendering  'ctl_lic_magne2'
    end array LIC_rendering
!
    begin LIC_repartition_ctl
      begin viz_data_files_def
        num_subdomain_ctl       7168
      end viz_data_files_def
!
      begin FEM_mesh_ctl
        FEM_surface_output_switch      'NO'
        FEM_viewer_mesh_output_switch  'NO'
      end FEM_mesh_ctl
!
      begin new_partitioning_ctl
!!!!      partition_reference_ctl:
!!!!         PREDICTED_COUNT, STACKED_COUNT, AVERAGE_COUNT
!!!!         VOLUME_BASED, NUMBER_BASED, or NO_REPARTITION
        partition_reference_ctl         VOLUME_BASED
        power_of_volume_ctl         0.5
        array dir_domain_ctl
          dir_domain_ctl  x     16
          dir_domain_ctl  y     16
          dir_domain_ctl  z     28
        end array dir_domain_ctl
        group_ratio_to_domain_ctl    100
      end new_partitioning_ctl
!
      begin FEM_sleeve_ctl
!!         sleeve_extension_mode: 
!!             element_count, sleeve_length, vector_trace
        sleeve_extension_mode       sleeve_length
        sleeve_size_ctl               0.05
!        reference_vector_ctl         velocity
      end FEM_sleeve_ctl
    end LIC_repartition_ctl
  end visual_control
!
  begin model
!!!!!  physical values!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
! available valuables 
!   velocity, temperature, pressure, vorticity
!   vector_potential, magnetic_field, current_density, magnetic_potential
!   composition, perturbation_temp
!
!   buoyancy_flux, Lorentz_work, mag_tension_work
!   magnetic_ene_generation
!   temp_generation, part_temp_gen
!   vis_ene_diffuse, mag_ene_diffuse
!
!   thermal_diffusion, viscous_diffusion, magnetic_diffusion
!   Coriolis_force, buoyancy
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    begin phys_values_ctl
      array nod_value_ctl
        nod_value_ctl  velocity                Viz_On   Monitor_On
        nod_value_ctl  temperature             Viz_On   Monitor_On
        nod_value_ctl  heat_source             Viz_Off  Monitor_Off
        nod_value_ctl  pressure                Viz_On   Monitor_On
        nod_value_ctl  vorticity               Viz_On   Monitor_On
        nod_value_ctl  magnetic_field          Viz_On   Monitor_On
        nod_value_ctl  current_density         Viz_On   Monitor_On
!
        nod_value_ctl  grad_temp             Viz_On   Monitor_On
        nod_value_ctl  buoyancy_flux         Viz_On   Monitor_On
        nod_value_ctl  Lorentz_work          Viz_On   Monitor_On
!
        nod_value_ctl  truncated_magnetic_field   Viz_On   Monitor_Off
      end array nod_value_ctl
    end phys_values_ctl
!
!!!!!  physical values for time evolution !!!!!!!!!!!!!!!!!!
! aviable valuables: velocity, temperature, magnetic_field
!                    vector_potential, composition
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    begin time_evolution_ctl
      array time_evo_ctl
        time_evo_ctl  temperature
        time_evo_ctl  velocity
        time_evo_ctl  magnetic_field
      end array time_evo_ctl
    end time_evolution_ctl
!
!!!!!  setting for boundary condition
!
    begin boundary_condition
      array bc_temperature
        bc_temperature  fixed_flux   ICB   3.44898
        bc_temperature  fixed_flux   CMB  -0.4225
      end array bc_temperature
!
      array bc_velocity
        bc_velocity  non_slip_sph   ICB   0.000
        bc_velocity  non_slip_sph    CMB   0.000
      end array bc_velocity
!
      array bc_composition      0
!
      array bc_magnetic_field
!        bc_magnetic_field  sph_to_center  to_Center  0.000
        bc_magnetic_field  insulator      ICB        0.000
        bc_magnetic_field  insulator      CMB        0.000
      end array bc_magnetic_field
    end boundary_condition
!
!    begin bc_4_surface
!      array heat_flux_surf           0
!      array velocity_surf            0
!      array pressure_surf            0
!      array magnetic_field_surf      0
!      array electric_potential_surf  0
!    end bc_4_surface
!
!!!!!  define of forces !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!  available forces
!     gravity, Coriolis, Lorentz
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    begin forces_define
      array force_ctl
        force_ctl   gravity
        force_ctl   Coriolis
        force_ctl   Lorentz
      end array force_ctl
    end forces_define
!
!!!!!  dimensionless numbers !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!  available numbers
!     Prandtl_number, magnetic_Prandtl_number
!     Rayleigh_number, modified_Rayleigh_number
!     Reynords_number
!     Taylor_number, Ekman_number
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    begin dimensionless_ctl
      array dimless_ctl
        dimless_ctl  Pr                   1.0e+0
        dimless_ctl  mod_Raf              2.0E+3
        dimless_ctl  Ek                   6.0e-4
        dimless_ctl  Pm                   5.0e+0
        dimless_ctl  R_o                  1.5384615e+0
      end array dimless_ctl
    end dimensionless_ctl
!
!!!!! Normalization settings  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!
!    define
!     coef_4_termal_ctl:      time integration and advection of temp
!     coef_4_velocity_ctl:    time integration and advection of temperature
!     coef_4_magnetic_ctl:    time integration and advection of magnetic f.
!     coef_4_t_diffuse_ctl:   coefficients for thermal diffusion
!     coef_4_v_diffuse_ctl:   coefficients for viscous diffusion
!     coef_4_m_diffuse_ctl:   coefficients for magnetic diffusion
!     coef_4_buoyancy_ctl:    coefficients for buoyancy
!     coef_4_Coriolis_ctl:    coefficients for Coriolis force
!     coef_4_Lorentz_ctl:     coefficients for Lorantz force
!     coef_4_composit_buoyancy_ctl: 
!                             coefficients for compositional buoyancy
!     coef_4_induction_ctl:   coefficients for magnetic induction
!
!     One:  1, Zero (Ignore), Two:  2,   Radial_parameter: (1-ri/ro)
!     Radial_35: (1-0.35)
!
!     Real number.... Power of each numbers
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!
    begin coefficients_ctl
      begin thermal
        array coef_4_termal_ctl     1
          coef_4_termal_ctl            One             1.0
        end array coef_4_termal_ctl
!
        array coef_4_t_diffuse_ctl  1
          coef_4_t_diffuse_ctl         Pr            -1.0
        end array coef_4_t_diffuse_ctl
      end thermal
!
!
      begin momentum
        array coef_4_velocity_ctl
          coef_4_velocity_ctl          One             1.0
        end array coef_4_velocity_ctl
!
        array coef_4_press_ctl
          coef_4_press_ctl             Ek              -1.0
        end array coef_4_press_ctl
!
        array coef_4_v_diffuse_ctl
          coef_4_v_diffuse_ctl         One             1.0
        end array coef_4_v_diffuse_ctl
!
        array coef_4_buoyancy_ctl
          coef_4_buoyancy_ctl          R_o             -1.0
          coef_4_buoyancy_ctl          mod_Raf          1.0
          coef_4_buoyancy_ctl          Ek              -1.0
        end array coef_4_buoyancy_ctl
!
        array coef_4_Coriolis_ctl
          coef_4_Coriolis_ctl          Two              1.0
          coef_4_Coriolis_ctl          Ek              -1.0
        end array coef_4_Coriolis_ctl
!
        array coef_4_Lorentz_ctl
          coef_4_Lorentz_ctl           Pm              -1.0
          coef_4_Lorentz_ctl           Ek              -1.0
        end array coef_4_Lorentz_ctl
      end momentum
!
!
      begin induction
        array coef_4_magnetic_ctl
          coef_4_magnetic_ctl          One              1.0
        end array coef_4_magnetic_ctl
!
        array coef_4_m_diffuse_ctl
          coef_4_m_diffuse_ctl         Pm              -1.0
        end array coef_4_m_diffuse_ctl
!
        array coef_4_induction_ctl
          coef_4_induction_ctl         One             -1.0
        end array coef_4_induction_ctl
      end induction
    end coefficients_ctl
!
!!!!!!!!! model for hydrostatic !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!
!    ref_temperature_ctl: none           (No reference of temperature)
!                         spherical_shell ( for spherical shell model)
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    begin temperature_define
      ref_temp_ctl     none
    end temperature_define
  end model
!
!
!
  begin control
!!!!!  information for sime integration
   begin time_step_ctl
      elapsed_time_ctl      83000.
      i_step_init_ctl         200
      i_step_finish_ctl       200
!
      i_step_check_ctl           1
      i_step_rst_ctl             1
      i_step_field_ctl           1
      i_step_sectioning_ctl      1
      i_step_pvr_ctl             1 
      i_step_LIC_ctl             1
!
      dt_ctl              4.0e-1
      time_init_ctl       0.0e-8
    end time_step_ctl
!
!!!!!  control for restart data
    begin restart_file_ctl
      rst_ctl                start_from_rst_file
    end restart_file_ctl
!
!!!!!!   method for time evolution
!
    begin time_loop_ctl
      scheme_ctl              Crank_Nicolson
      coef_imp_v_ctl          6.0e-1
      coef_imp_t_ctl          6.0e-1
      coef_imp_b_ctl          6.0e-1
      coef_imp_d_ctl          6.0e-1
!
      FFT_library_ctl         FFTW
      send_recv_routine_ctl          'SEND_RECV'
!
      Legendre_trans_loop_ctl   'SYMMETRIC_MATMUL_BIG'
    end time_loop_ctl
  end control
!
  begin sph_monitor_ctl
    volume_average_prefix        'sph_ave_volume'
    volume_pwr_spectr_prefix     'sph_pwr_volume'
    nusselt_number_prefix        'Nusselt'
!
!    begin layered_spectrum_ctl
!      layered_pwr_spectr_prefix    'sph_pwr_layer'
!    end layered_spectrum_ctl
!
    begin pickup_spectr_ctl
      picked_sph_prefix     'picked_mode'
!
      array pick_layer_ctl
        pick_layer_ctl    1
        pick_layer_ctl  113
        pick_layer_ctl  225
      end array pick_layer_ctl
!
      array pick_sph_degree_ctl
        pick_sph_degree_ctl   0
        pick_sph_degree_ctl   1
        pick_sph_degree_ctl   2
      end array pick_sph_degree_ctl
!
      array pick_sph_spectr_ctl
        pick_sph_spectr_ctl   3  -2
        pick_sph_spectr_ctl   3   0
        pick_sph_spectr_ctl   3   2
      end array pick_sph_spectr_ctl
    end pickup_spectr_ctl
!
    begin gauss_coefficient_ctl
      gauss_coefs_prefix    'gauss_coefs_Re'
      gauss_coefs_radius_ctl    2.82
!
      array pick_gauss_coef_degree_ctl
        pick_gauss_coef_degree_ctl   1
        pick_gauss_coef_degree_ctl   3
      end array pick_gauss_coef_degree_ctl
    end gauss_coefficient_ctl
!
!    array volume_spectrum_ctl
!      begin volume_spectrum_ctl
!        volume_pwr_spectr_prefix     'sph_pwr_convective'
!        volume_average_prefix        'sph_ave_convective'
!        inner_radius_ctl           0.54346
!        outer_radius_ctl           1.53346
!      end volume_spectrum_ctl
!    end array volume_spectrum_ctl
  end sph_monitor_ctl
end MHD_control
